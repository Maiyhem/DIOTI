{% extends "base.html" %}

{% block content %}
<link rel="stylesheet" href="http://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css"></style>

<style>
  /* 16 */
.tab-tab {
  border: none;
  color: #000;
}
.tab-tab:after {
  position: absolute;
  content: "";
  width: 0;
  height: 100%;
  top: 0;
  left: 0;
  direction: rtl;
  z-index: -1;
  box-shadow:
   -7px -7px 20px 0px #fff9,
   -4px -4px 5px 0px #fff9,
   7px 7px 20px 0px #0002,
   4px 4px 5px 0px #0001;
  transition: all 0.3s ease;
}
.tab-tab:hover {
  color: #000;
}
.tab-tab:hover:after {
  left: auto;
  right: 0;
  width: 100%;
}
.tab-tab:active {
  top: 2px;
}
.tab-tab.active
 {
  background-color: primary;
  padding: -10px -10px;
  border-radius: 20px;

 }
 .button__badge {
  background-color: #3e96fa;
  border-radius: 2px;
  color: white;
 
  padding: 1px 3px;
  font-size: 12px;
  
  position: relative; /* Position the badge within the relatively positioned button */
  top: 0;
  right: 0;
}
body{
background-color: #eee; 
}

table th , table td{
    text-align: left;
}

table tr:nth-child(even){
background-color: #e4e3e3
}

th {
background: #ffffff;
color: #000000;
}

.pagination {
margin: 0;
}

.pagination li:hover{
cursor: pointer;
}

.header_wrap {
padding:30px 0;
}
.num_rows {
width: 20%;
float:left;
}
.tb_search{
border-radius: 20px;
width: 20%;
float:right;
}
.pagination-container {
width: 70%;
float:left;
}

.rows_count {
width: 20%;
float:right;
text-align:right;
color: #999;
}

/* btn style */
body {
  background: #e0e5ec;
}
h1 {
  position: relative;
  text-align: center;
  color: #353535;
  font-size: 50px;
  font-family: "Cormorant Garamond", serif;
}

p {
  font-family: 'Lato', sans-serif;
  font-weight: 300;
  text-align: center;
  font-size: 18px;
  color: #676767;
}
.frame {
  width: 90%;
  margin: 40px auto;
  text-align: center;
}
button {
  margin: 20px;
}
.custom-btn {
  width: 130px;
  height: 50px;
  color: #fff;
  border-radius: 5px;
  padding: 10px 25px;
  font-family: 'Lato', sans-serif;
  font-weight: 500;
  background: transparent;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  display: inline-block;
   box-shadow:inset 2px 2px 2px 0px rgba(255,255,255,.5),
   7px 7px 20px 0px rgba(0,0,0,.1),
   4px 4px 5px 0px rgba(0,0,0,.1);
  outline: none;
}

/* 16 */
.btn-16 {
  border: none;
  color: #000;
}
.btn-16:after {
  position: absolute;
  content: "";
  width: 0;
  height: 100%;
  top: 0;
  left: 0;
  direction: rtl;
  z-index: -1;
  box-shadow:
   -7px -7px 20px 0px #fff9,
   -4px -4px 5px 0px #fff9,
   7px 7px 20px 0px #0002,
   4px 4px 5px 0px #0001;
  transition: all 0.3s ease;
}
.btn-16:hover {
  color: #000;
}
.btn-16:hover:after {
  left: auto;
  right: 0;
  width: 100%;
}
.btn-16:active {
  top: 2px;
}


/* .slideThree */
.slideThree {
  width: 80px;
  height: 26px;
  background: #d3d3d3;
  margin: 20px auto;
  position: relative;
  border-radius: 50px;
  box-shadow: inset 0px 1px 1px rgba(0, 0, 0, 0.5), 0px 1px 0px rgba(255, 255, 255, 0.2);
}
.slideThree:after {
  content: 'OFF';
  color: #000;
  position: absolute;
  right: 10px;
  z-index: 0;
  font: 12px/26px Arial, sans-serif;
  font-weight: bold;
  text-shadow: 1px 1px 0px rgba(255, 255, 255, 0.15);
}
.slideThree:before {
  content: 'ON';
  color: #27ae60;
  position: absolute;
  left: 10px;
  z-index: 0;
  font: 12px/26px Arial, sans-serif;
  font-weight: bold;
}
.slideThree label {
  display: block;
  width: 34px;
  height: 20px;
  cursor: pointer;
  position: absolute;
  top: 3px;
  left: 3px;
  z-index: 1;
  background: #fcfff4;
  background: linear-gradient(to bottom, #fcfff4 0%, #dfe5d7 40%, #b3bead 100%);
  border-radius: 50px;
  transition: all 0.4s ease;
  box-shadow: 0px 2px 5px 0px rgba(0, 0, 0, 0.3);
}
.slideThree input[type=checkbox] {
  visibility: hidden;
}
.slideThree input[type=checkbox]:checked + label {
  left: 43px;
}

/* end .slideThree */
</style>




        
<div class="projects-section" style="width: 100%;">
        
    <ul class="nav nav-tabs">
        
        <li class="tab-tab"><a data-toggle="tab" href="#home" ><button class="custom-btn btn-16"> All </button> </a></li>
        <li class="tab-tab"><a data-toggle="tab" href="#success"  ><button class="custom-btn btn-16"> success </button></a></li>
        <li  class="tab-tab"><a data-toggle="tab" href="#menu1" ><button class="custom-btn btn-16"> No Price </button> </a></li>
        <li  class="tab-tab"><a data-toggle="tab" href="#menu2" ><button class="custom-btn btn-16"> Call Us </button></a></li>
        <li  class="tab-tab"><a data-toggle="tab" href="#menu3"><button class="custom-btn btn-16"> Error </button></a></li>
        
    </ul>

    <div class="tab-content">
        <div id="home" class="tab-pane fade active show in" style="text-align: right;">
        <div class="table-responsive">
            {% csrf_token %}
            <table id="myTable" class="table custom-table">
              <thead>
                  <tr>  
                      <th scope="col">ID</th>
                      <th scope="col">Name</th>
                      <th scope="col">Link</th>
                      <th scope="col">Status</th>
                      <th scope="col">Last Price Update</th>
                      <th scope="col">Last scraped</th>
                      <th scope="col">Web Price</th>
                      <th scope="col">Scrap Price</th>
                      <th scope="col">Action</th>
                      <th scope="col">Action</th>
                  </tr>
              </thead>
              <tbody>
                  {% for p in products %}
                  <tr scope="row">
                    <td>{{p.id}}</td>
                    <td><a href="#">{{p.name}}</a></td>
                    <td style="width: 300px;">
                    <input
                        id="targetLink_{{p.id}}"
                        type="text"
                        class="target-link-input"
                        value="{{ p.target_link }}"
                        disabled
                    />
                    </td>
                    <td>{{p.crawl_status}}</td>
                    <td>{{p.last_web_price_update}}</td>
                    <td>{{p.last_scrape}}</td>
                    <td>{{p.web_price}}</td>
                    <td>{{p.scrap_price}}</td>
                    <td>
                    <input
                        disabled
                        id="AED_price{{p.id}}"
                        type="text"
                        class="AED-input"
                        value="{{ p.AED_price }}"
                    />
                    </td>
                    <td>
                    <button class="btn btn-primary" onclick="updateProduct('{{ p.id }}')">
                        confirm
                    </button>
                    <!-- .squaredThree -->
                    <div class="slideThree">
                        <input
                        type="checkbox"
                        value="None"
                        id="slideThree_{{p.id}}"
                        name="check"
                        onchange="toggleInputs({{ p.id }})"
                        
                        />
                        <label for="slideThree_{{p.id}}"></label>
                    </div>
                    <!-- end .squaredThree -->
                    </td>
                </tr>
                  {% endfor %}
              </tbody>
          </table>

        </div>
        </div>
        <div id="success" class="tab-pane fade  show in" style="text-align: right;">
            <div class="table-responsive">
                {% csrf_token %}
                <table id="myTable1" class="table custom-table">
                
                <thead>
                    <tr>  
                    
                    <th scope="col">ID</th>
                    <th scope="col">Name</th>
                    <th scope="col">Link</th>
                    <th scope="col">Status</th>
                    <th scope="col">Last Price Update</th>
                    <th scope="col">Last scraped</th>
                    <th scope="col">Web Price</th>
                    <th scope="col">Scrap Price</th>
                    <th scope="col">Action</th>
                    <th scope="col">Action</th>
                    </tr>
                </thead>
                
                <tbody>
                    {% for p in products %}
                        {% if p.crawl_status == 'Success'%}
                        <tr scope="row">
                            <td>{{p.id}}</td>
                            <td><a href="#">{{p.name}}</a></td>
                            <td style="width: 300px;">
                            <input
                                id="targetLink_{{p.id}}"
                                type="text"
                                class="target-link-input"
                                value="{{ p.target_link }}"
                                disabled
                            />
                            </td>
                            <td>{{p.crawl_status}}</td>
                            <td>{{p.last_web_price_update}}</td>
                            <td>{{p.last_scrape}}</td>
                            <td>{{p.web_price}}</td>
                            <td>{{p.scrap_price}}</td>
                            <td>
                            <input
                                disabled
                                id="AED_price{{p.id}}"
                                type="text"
                                class="AED-input"
                                value="{{ p.AED_price }}"
                            />
                            </td>
                            <td>
                            <button class="btn btn-primary" onclick="updateProduct('{{ p.id }}')">
                                confirm
                            </button>
                            <!-- .squaredThree -->
                            <div class="slideThree">
                                <input
                                type="checkbox"
                                value="None"
                                id="slideThree_{{p.id}}"
                                name="check"
                                onchange="toggleInputs({{ p.id }})"
                                
                                />
                                <label for="slideThree_{{p.id}}"></label>
                            </div>
                            <!-- end .squaredThree -->
                            </td>
                        </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
                
                </table>
        
            </div>
            </div>

        <div id="menu1" class="tab-pane fade  show in" style="text-align: right;">
            <div class="table-responsive">
                {% csrf_token %}
                <table id="myTable2" class="table custom-table">
                    
                    <thead>
                    <tr>  
                        
                        <th scope="col">ID</th>
                        <th scope="col">Name</th>
                        <th scope="col">Link</th>
                        <th scope="col">Status</th>
                        <th scope="col">Last Price Update</th>
                        <th scope="col">Last scraped</th>
                        <th scope="col">Web Price</th>
                        <th scope="col">Scrap Price</th>
                        <th scope="col">Action</th>
                        <th scope="col">Action</th>
                    </tr>
                    </thead>
                    
                    <tbody>
                        {% for p in products %}
                        {% if p.crawl_status == 'No Price'%}
                        <tr scope="row">
                        <td>{{p.id}}</td>
                        <td><a href="#">{{p.name}}</a></td>
                        <td style="width: 300px;">
                            <input
                            id="targetLink_{{p.id}}"
                            type="text"
                            class="target-link-input"
                            value="{{ p.target_link }}"
                            disabled
                            />
                        </td>
                        <td>{{p.crawl_status}}</td>
                        <td>{{p.last_web_price_update}}</td>
                        <td>{{p.last_scrape}}</td>
                        <td>{{p.web_price}}</td>
                        <td>{{p.scrap_price}}</td>
                        <td>
                            <input
                            disabled
                            id="AED_price{{p.id}}"
                            type="text"
                            class="AED-input"
                            value="{{ p.AED_price }}"
                            />
                        </td>
                        <td>
                            <button class="btn btn-primary" onclick="updateProduct('{{ p.id }}')">
                            confirm
                            </button>
                            <!-- .squaredThree -->
                            <div class="slideThree">
                            <input
                                type="checkbox"
                                value="None"
                                id="slideThree_{{p.id}}"
                                name="check"
                                onchange="toggleInputs({{ p.id }})"
                                
                            />
                            <label for="slideThree_{{p.id}}"></label>
                            </div>
                            <!-- end .squaredThree -->
                        </td>
                        </tr>
                    {% endif %}
                    {% endfor %}
                    </tbody>
                
                </table>
        
                </div>
            </div>
        <div id="menu2" class="tab-pane fade  show in" style="text-align: right;">
            <div class="table-responsive">
                {% csrf_token %}
                <table id="myTable3" class="table custom-table">
                    
                    <thead>
                    <tr>  
                        
                        <th scope="col">ID</th>
                        <th scope="col">Name</th>
                        <th scope="col">Link</th>
                        <th scope="col">Status</th>
                        <th scope="col">Last Price Update</th>
                        <th scope="col">Last scraped</th>
                        <th scope="col">Web Price</th>
                        <th scope="col">Scrap Price</th>
                        <th scope="col">Action</th>
                        <th scope="col">Action</th>
                    </tr>
                    </thead>
                  
                    <tbody>
                        {% for p in products %}
                        {% if p.crawl_status == 'Call Us Price'%}
                        <tr scope="row">
                        <td>{{p.id}}</td>
                        <td><a href="#">{{p.name}}</a></td>
                        <td style="width: 300px;">
                            <input
                            id="targetLink_{{p.id}}"
                            type="text"
                            class="target-link-input"
                            value="{{ p.target_link }}"
                            disabled
                            />
                        </td>
                        <td>{{p.crawl_status}}</td>
                        <td>{{p.last_web_price_update}}</td>
                        <td>{{p.last_scrape}}</td>
                        <td>{{p.web_price}}</td>
                        <td>{{p.scrap_price}}</td>
                        <td>
                            <input
                            disabled
                            id="AED_price{{p.id}}"
                            type="text"
                            class="AED-input"
                            value="{{ p.AED_price }}"
                            />
                        </td>
                        <td>
                            <button class="btn btn-primary" onclick="updateProduct('{{ p.id }}')">
                            confirm
                            </button>
                            <!-- .squaredThree -->
                            <div class="slideThree">
                            <input
                                type="checkbox"
                                value="None"
                                id="slideThree_{{p.id}}"
                                name="check"
                                onchange="toggleInputs({{ p.id }})"
                                
                            />
                            <label for="slideThree_{{p.id}}"></label>
                            </div>
                            <!-- end .squaredThree -->
                        </td>
                        </tr>
                    {% endif %}
                    {% endfor %}
                    </tbody>
                
                </table>
        </div>
                </div>
            
        <div id="menu3" class="tab-pane fade  show in" style="text-align: right;">
            <div class="table-responsive">
                {% csrf_token %}
             <table id="myTable4" class="table custom-table">
    <thead>
        <tr>  
            <th scope="col">ID</th>
            <th scope="col">Name</th>
            <th scope="col">Link</th>
            <th scope="col">Status</th>
            <th scope="col">Last Price Update</th>
            <th scope="col">Last scraped</th>
            <th scope="col">Web Price</th>
            <th scope="col">Scrap Price</th>
            <th scope="col">Action</th>
            <th scope="col">Action</th>
        </tr>
    </thead>
    <tbody>
        {% for p in products %}
        {% if p.crawl_status == 'error'%}
        <tr scope="row">
            <td>{{p.id}}</td>
            <td><a href="#">{{p.name}}</a></td>
            <td style="width: 300px;">
                <input
                    id="targetLink_{{p.id}}"
                    type="text"
                    class="target-link-input"
                    value="{{ p.target_link }}"
                    disabled
                />
            </td>
            <td>{{p.crawl_status}}</td>
            <td>{{p.last_price_update}}</td>
            <td>{{p.last_scrape}}</td>
            <td>{{p.web_price}}</td>
            <td>{{p.scrap_price}}</td>
            <td>
                <input
                    disabled
                    id="AED_price_{{p.id}}"
                    type="text"
                    class="AED-input"
                    value="{{ p.AED_price }}"
                />
            </td>
            <td>
                <button class="btn btn-primary" onclick="updateProduct('{{ p.id }}')">
                    confirm
                </button>
                <!-- .squaredThree -->
                <div class="slideThree">
                <input
                    type="checkbox"
                    value="None"
                    id="slideThree_{{p.id}}"
                    name="check"
                    onchange="toggleInputs({{ p.id }})"
                    
                />
                <label for="slideThree_{{p.id}}"></label>
                </div>
            </td>
        </tr>
        {% endif %}
        {% endfor %}
    </tbody>
</table>
                </div>
            </div>
    </div>
    </div>
  

    <!-- 		End of Container -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script>

$(document).ready(function(){
        $('#myTable').dataTable();
        $('#myTable1').dataTable();
        $('#myTable2').dataTable();
        $('#myTable3').dataTable();
        $('#myTable4').dataTable();
         });  


function toggleInputs(productId) {
        const targetLinkInput = document.getElementById(`targetLink_${productId}`);
        const AEDPriceInput = document.getElementById(`AED_price${productId}`);

        if (document.getElementById(`slideThree_${productId}`).checked) {
        targetLinkInput.disabled = false;
        AEDPriceInput.disabled = false;
        } else {
        targetLinkInput.disabled = true;
        AEDPriceInput.disabled = true;
        }
    }

function updateProduct(productId) {
        // Get the updated target link from the input field
        const confirmed = confirm("Are you sure you want to update this product?");

        // Check the user's choice
        if (confirmed) {
          // User clicked "OK," proceed with the update
          const updatedTargetLink = $(`#targetLink_${productId}`).val();
          const data = {
          csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
          product_id: productId,
          target_link: updatedTargetLink,
        };

          $.ajax({
                url: "{% url 'ajax-update-target-link' %}",  // URL of your Django view
                type: "POST",
                data: data,
                success: function (response) {
                  // Handle the success response here
                  if (response.success) {
                    alert("Update successful!");
                    // You can update the UI here if needed
                  } else {
                    alert("Update failed.");
                    // Handle any other response if needed
                  }
                },
                error: function () {
                  // Handle errors here
                  alert("Error occurred during the update.");
                },
        });
        } else {
          alert('not confirmed')
          // User clicked "Cancel," do nothing or provide feedback
          // You can optionally add a message here or take other actions.
        }


       
        // Perform the update using AJAX (you'll need to implement this)
        // You can use productId and updatedTargetLink to send the data to your server
        // ...
      }


     

</script>

{% endblock %}
